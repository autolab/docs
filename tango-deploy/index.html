
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="shortcut icon" href="../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.6.1">
    
    
      
        <title>Deploying Tango - Autolab Docs</title>
      
    
    
      <script src="../assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-4d0d3f2fbf.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-f78e5cb881.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="red" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href=".." title="Autolab Docs" class="md-logo md-header-nav__button">
            <img src="../images/logo.svg" width="24" height="24">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Tango
                </span>
              
            
            Deploying Tango
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
            


  


  <a href="https://github.com/Autolab/autolab" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Autolab
    </div>
  </a>

          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-logo md-nav__button">
        <img src="../images/logo.svg">
      </i>
    
    Autolab Docs
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/Autolab/autolab" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Autolab
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Autolab
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Autolab
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href=".." title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../instructors/" title="Guide for Instructors" class="md-nav__link">
      Guide for Instructors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab/" title="Guide for Lab Authors" class="md-nav__link">
      Guide for Lab Authors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../features/" title="Features" class="md-nav__link">
      Features
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-5" type="checkbox" id="nav-1-5">
    
    <label class="md-nav__link" for="nav-1-5">
      API (Beta Feature)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-5">
        API (Beta Feature)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../api-overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api-interface/" title="Reference" class="md-nav__link">
      Reference
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Tango
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tango
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tango/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tango-cli/" title="Tango CLI" class="md-nav__link">
      Tango CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tango-rest/" title="REST API" class="md-nav__link">
      REST API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tango-vmms/" title="VMMS Docs" class="md-nav__link">
      VMMS Docs
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Deploying Tango
      </label>
    
    <a href="./" title="Deploying Tango" class="md-nav__link md-nav__link--active">
      Deploying Tango
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#details" title="Details" class="md-nav__link">
    Details
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#steps" title="Steps" class="md-nav__link">
    Steps
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../one-click/" title="OneClick Install" class="md-nav__link">
      OneClick Install
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#details" title="Details" class="md-nav__link">
    Details
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#steps" title="Steps" class="md-nav__link">
    Steps
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="deploying-standalone-tango">Deploying Standalone Tango</h1>
<p>This is a guide to setup a fully self-sufficient Tango deployment environment out-of-the-box using Docker. The suggested deployment pattern for Tango uses Nginx as a proxy and Supervisor as a process manager for Tango and all its dependencies. All requests to Nginx are rerouted to a Tango process. </p>
<h2 id="details">Details</h2>
<ul>
<li>Nginx default port - 8600</li>
<li>Tango ports - 8610, 8611</li>
<li>Redis port - 6379</li>
<li>You can change any of these in the respective config files in <code>deployment/config/</code> before you build the <code>tango_deployment</code> image.</li>
</ul>
<h2 id="steps">Steps</h2>
<ol>
<li>
<p>Clone the Tango repo</p>
<pre class="codehilite"><code class="language-sh linenums">$ git clone https://github.com/autolab/Tango.git; cd Tango</code></pre>


</li>
<li>
<p>Create a <code>config.py</code> file from the given template.  </p>
<pre class="codehilite"><code class="language-sh linenums">$ cp config.template.py config.py</code></pre>


</li>
<li>
<p>Install docker on the host machine by following instructions on the <a href="https://docs.docker.com/installation/">docker installation page</a>. Ensure docker is running:</p>
<pre class="codehilite"><code class="language-sh linenums">$ docker ps
# CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                    NAMES</code></pre>


</li>
<li>
<p>Run the following command to build the Tango deployment image. </p>
<pre class="codehilite"><code class="language-sh linenums">$ docker build --tag=&quot;tango_deployment&quot; .</code></pre>


</li>
<li>
<p>Ensure the image was built by running.</p>
<pre class="codehilite"><code class="language-sh linenums">$ docker images
# REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
# tango_deployment    latest              3c0d4f4b4958        2 minutes ago       742.6 MB
# ubuntu              15.04               d1b55fd07600        4 minutes ago       131.3 MB</code></pre>


</li>
<li>
<p>Run the following command to access the image in a container with a bash shell. The <code>-p</code> flag will map <code>nginxPort</code> on the docker container to <code>localPort</code> (8610 recommended) on your local machine (or on the VM that docker is running in on the local machine) so that Tango is accessible from outside the docker container.</p>
<pre class="codehilite"><code class="language-sh linenums">$ docker run --privileged -p &lt;localPort&gt;:&lt;nginxPort&gt; -it tango_deployment /bin/bash</code></pre>


</li>
<li>
<p>Set up a VMMS for Tango within the Docker container.</p>
<ul>
<li><a href="../tango-vmms/#docker-vmms-setup">Docker</a> (<strong>recommended</strong>)</li>
<li><a href="../tango-vmms/#amazon-ec2-vmms-setup">Amazon EC2</a></li>
</ul>
</li>
<li>
<p>Run the following command to start supervisor, which will then start Tango and all its dependencies.</p>
<pre class="codehilite"><code class="language-sh linenums">$ service supervisor start</code></pre>


</li>
<li>
<p>Check to see if Tango is responding to requests</p>
<pre class="codehilite"><code class="language-sh linenums">$ curl localhost:8610
# Hello, world! RESTful Tango here!</code></pre>


</li>
<li>
<p>Once you have a VMMS set up, leave the tango_deployment container by typing <code>exit</code> and once back in the host shell run the following command to get the name of your production container.</p>
<pre class="codehilite"><code class="language-sh linenums">$ docker ps -as
# CONTAINER ID        IMAGE               COMMAND               NAMES               SIZE
# c704d45c3737    tango_deployment       &quot;/bin/bash&quot;            erwin             40.26 MB

The container created in this example has the name `erwin`.</code></pre>


</li>
<li>
<p>The name of the production container can be changed by running the following command and will be used to run the container and create services.</p>
<pre class="codehilite"><code class="language-sh linenums">$ docker rename &lt;old_name&gt; &lt;new_name&gt;</code></pre>


</li>
<li>
<p>To reopen the container once it has been built use the following command. This will reopen the interactive shell within the container and allow for configuration of the container after its initial run.</p>
<pre class="codehilite"><code class="language-sh linenums">$ docker start erwin
$ docker attach erwin</code></pre>


</li>
<li>
<p>Once the container is set up with the autograding image, and the VMMS configured with any necessary software/environments needed for autograding (java, perl, etc), some configurations need to be changed to make the container daemon ready. Using the <code>CONTAINER ID</code> above, use the following commands to modify that containers <code>config.v2.json</code> file.</p>
<pre class="codehilite"><code class="language-sh linenums">$ sudo ls  /var/lib/docker/containers
c704d45c37372a034cb97761d99f6f3f362707cc23d689734895e017eda3e55b
$ sudo vim /var/lib/docker/containers/c704d45c37372a034cb97761d99f6f3f362707cc23d689734895e017eda3e55b/config.v2.json</code></pre>


</li>
<li>
<p>Edit the "Path" field in the config.v2.json file from "/bin/bash" to "/usr/bin/supervisord" and save the file. Run the following commands to verify the changes were successful. The COMMAND field should now be "/usr/bin/supervisord" </p>
<pre class="codehilite"><code class="language-sh linenums">$ service docker restart
$ docker ps -as
# CONTAINER ID        IMAGE               COMMAND               NAMES               SIZE
# c704d45c3737    tango_deployment   &quot;/usr/bin/supervisord&quot;     erwin             40.26 MB</code></pre>


</li>
<li>
<p>At this point when the container is started, the environment is fully set up and will no longer be an interactive shell. Instead, it will be the supervisor service that starts Tango and all its dependencies. Test this with the following commands and ensure Tango is functioning properly.</p>
<pre class="codehilite"><code class="language-sh linenums">$ docker start erwin
# (Test tango environment)
$ docker stop erwin</code></pre>


</li>
<li>
<p>Test the setup by running sample jobs using <a href="../tango-cli">the testing guide</a>.</p>
</li>
</ol>
<p><strong>The following steps are optional and should only be used if you would like the Tango container to start on system boot.</strong></p>
<ol>
<li>
<p>To ensure Tango starts with the system in the production environment, the container needs to be configured as a service. Below is a sample service config file that needs to be changed to suit your environment and placed in <code>/etc/systemd/system/</code>. The file should be named <code>&lt;name&gt;.service</code>. For this example, it is <code>erwin.service</code>.</p>
<pre class="codehilite"><code class="language-sh linenums">[Unit]
Description=Docker Service Managing Tango Container
Requires=docker.service
After=docker.service

[Service]
Restart=always
ExecStart=/usr/bin/docker start -a erwin
ExecStop=/usr/bin/docker stop -t 2 erwin

[Install]
WantedBy=default.target</code></pre>


</li>
<li>
<p>Test and ensure the service was set up correctly. The service should start successfully and remain running.</p>
<pre class="codehilite"><code class="language-sh linenums">$ systemctl daemon-reload
$ service erwin start
$ service erwin status</code></pre>


</li>
<li>
<p>Enable the service at system startup and reboot and ensure it starts with the host.</p>
<pre class="codehilite"><code class="language-sh linenums">$ systemctl enable erwin.service
$ sudo reboot
# (Server Reboots)
$ service erwin status</code></pre>


</li>
</ol>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../tango-vmms/" title="VMMS Docs" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                VMMS Docs
              </span>
            </div>
          </a>
        
        
          <a href="../one-click/" title="OneClick Install" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                OneClick Install
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/Autolab" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://facebook.com/autolabproject" class="md-footer-social__link fa fa-facebook"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-6b599127bc.js"></script>
      <script>app.initialize({url:{base:".."}})</script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-79424729-3","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>